<!DOCTYPE html>
<html lang="es">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Asistente IA - Nocodia</title>
Â  <style>
Â  Â  * {
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  Â  box-sizing: border-box;
Â  Â  }
Â  Â Â 
Â  Â  body {
Â  Â  Â  font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
Â  Â  Â  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
Â  Â  Â  height: 100vh;
Â  Â  Â  overflow: hidden;
Â  Â  }
Â  Â Â 
Â  Â  .chat-container {
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  height: 100vh;
Â  Â  Â  max-width: 100%;
Â  Â  Â  margin: 0 auto;
Â  Â  Â  background: white;
Â  Â  }
Â  Â Â 
Â  Â  .chat-header {
Â  Â  Â  background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
Â  Â  Â  color: white;
Â  Â  Â  padding: 20px;
Â  Â  Â  text-align: center;
Â  Â  Â  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
Â  Â  }
Â  Â Â 
Â  Â  .chat-header h1 {
Â  Â  Â  font-size: clamp(1.2rem, 4vw, 1.8rem);
Â  Â  Â  font-weight: 800;
Â  Â  Â  margin-bottom: 5px;
Â  Â  }
Â  Â Â 
Â  Â  .chat-header p {
Â  Â  Â  font-size: clamp(0.85rem, 3vw, 1rem);
Â  Â  Â  opacity: 0.9;
Â  Â  }
Â  Â Â 
Â  Â  .messages-container {
Â  Â  Â  flex: 1;
Â  Â  Â  overflow-y: auto;
Â  Â  Â  padding: 20px;
Â  Â  Â  background: #f9fafb;
Â  Â  }
Â  Â Â 
Â  Â  .message {
Â  Â  Â  display: flex;
Â  Â  Â  margin-bottom: 16px;
Â  Â  Â  animation: slideIn 0.3s ease;
Â  Â  }
Â  Â Â 
Â  Â  @keyframes slideIn {
Â  Â  Â  from {
Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  transform: translateY(10px);
Â  Â  Â  }
Â  Â  Â  to {
Â  Â  Â  Â  opacity: 1;
Â  Â  Â  Â  transform: translateY(0);
Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  .message.user {
Â  Â  Â  justify-content: flex-end;
Â  Â  }
Â  Â Â 
Â  Â  .message-content {
Â  Â  Â  max-width: 80%;
Â  Â  Â  padding: 12px 16px;
Â  Â  Â  border-radius: 18px;
Â  Â  Â  word-wrap: break-word;
Â  Â  Â  font-size: clamp(0.9rem, 3.5vw, 1rem);
Â  Â  Â  line-height: 1.5;
Â  Â  }
Â  Â Â 
Â  Â  .message.user .message-content {
Â  Â  Â  background: var(--color-primary);
Â  Â  Â  color: white;
Â  Â  Â  border-bottom-right-radius: 4px;
Â  Â  }
Â  Â Â 
Â  Â  .message.assistant .message-content {
Â  Â  Â  background: white;
Â  Â  Â  color: #111827;
Â  Â  Â  border: 1px solid #e5e7eb;
Â  Â  Â  border-bottom-left-radius: 4px;
Â  Â  }
Â  Â Â 
Â  Â  .typing-indicator {
Â  Â  Â  display: none;
Â  Â  Â  padding: 12px 16px;
Â  Â  Â  background: white;
Â  Â  Â  border: 1px solid #e5e7eb;
Â  Â  Â  border-radius: 18px;
Â  Â  Â  border-bottom-left-radius: 4px;
Â  Â  Â  max-width: 80px;
Â  Â  }
Â  Â Â 
Â  Â  .typing-indicator.active {
Â  Â  Â  display: block;
Â  Â  }
Â  Â Â 
Â  Â  .typing-dot {
Â  Â  Â  display: inline-block;
Â  Â  Â  width: 8px;
Â  Â  Â  height: 8px;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  background: #9ca3af;
Â  Â  Â  margin: 0 2px;
Â  Â  Â  animation: typing 1.4s infinite;
Â  Â  }
Â  Â Â 
Â  Â  .typing-dot:nth-child(2) {
Â  Â  Â  animation-delay: 0.2s;
Â  Â  }
Â  Â Â 
Â  Â  .typing-dot:nth-child(3) {
Â  Â  Â  animation-delay: 0.4s;
Â  Â  }
Â  Â Â 
Â  Â  @keyframes typing {
Â  Â  Â  0%, 60%, 100% {
Â  Â  Â  Â  transform: translateY(0);
Â  Â  Â  }
Â  Â  Â  30% {
Â  Â  Â  Â  transform: translateY(-10px);
Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  .input-container {
Â  Â  Â  padding: 16px;
Â  Â  Â  background: white;
Â  Â  Â  border-top: 1px solid #e5e7eb;
Â  Â  Â  box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
Â  Â  }
Â  Â Â 
Â  Â  .input-wrapper {
Â  Â  Â  display: flex;
Â  Â  Â  gap: 10px;
Â  Â  Â  max-width: 100%;
Â  Â  }
Â  Â Â 
Â  Â  #userInput {
Â  Â  Â  flex: 1;
Â  Â  Â  padding: 12px 16px;
Â  Â  Â  border: 2px solid #e5e7eb;
Â  Â  Â  border-radius: 24px;
Â  Â  Â  font-size: clamp(0.9rem, 3.5vw, 1rem);
Â  Â  Â  outline: none;
Â  Â  Â  transition: border-color 0.3s;
Â  Â  Â  font-family: inherit;
Â  Â  }
Â  Â Â 
Â  Â  #userInput:focus {
Â  Â  Â  border-color: var(--color-primary);
Â  Â  }
Â  Â Â 
Â  Â  #sendButton {
Â  Â  Â  padding: 12px 24px;
Â  Â  Â  background: var(--color-primary);
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 24px;
Â  Â  Â  font-weight: 700;
Â  Â  Â  font-size: clamp(0.9rem, 3.5vw, 1rem);
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: all 0.3s;
Â  Â  Â  white-space: nowrap;
Â  Â  }
Â  Â Â 
Â  Â  #sendButton:hover:not(:disabled) {
Â  Â  Â  background: var(--color-secondary);
Â  Â  Â  transform: scale(1.02);
Â  Â  }
Â  Â Â 
Â  Â  #sendButton:disabled {
Â  Â  Â  background: #9ca3af;
Â  Â  Â  cursor: not-allowed;
Â  Â  }
Â  Â Â 
Â  Â  .welcome-message {
Â  Â  Â  text-align: center;
Â  Â  Â  padding: 40px 20px;
Â  Â  Â  color: #6b7280;
Â  Â  }
Â  Â Â 
Â  Â  .welcome-message h2 {
Â  Â  Â  font-size: clamp(1.2rem, 4vw, 1.6rem);
Â  Â  Â  color: #111827;
Â  Â  Â  margin-bottom: 10px;
Â  Â  }
Â  Â Â 
Â  Â  .branding {
Â  Â  Â  text-align: center;
Â  Â  Â  padding: 10px;
Â  Â  Â  font-size: 11px;
Â  Â  Â  color: #9ca3af;
Â  Â  Â  background: #f9fafb;
Â  Â  }
Â  Â Â 
Â  Â  @media (min-width: 768px) {
Â  Â  Â  .chat-container {
Â  Â  Â  Â  max-width: 800px;
Â  Â  Â  Â  height: 90vh;
Â  Â  Â  Â  margin: 5vh auto;
Â  Â  Â  Â  border-radius: 16px;
Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  body {
Â  Â  Â  Â  overflow: auto;
Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  @media (max-width: 767px) {
Â  Â  Â  .message-content {
Â  Â  Â  Â  max-width: 85%;
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  #sendButton {
Â  Â  Â  Â  padding: 12px 20px;
Â  Â  Â  }
Â  Â  }
Â  </style>
</head>
<body>
Â  <div class="chat-container">
Â  Â  <div class="chat-header">
Â  Â  Â  <h1 id="chatTitle">ğŸ¤– Asistente IA</h1>
Â  Â  Â  <p id="chatSubtitle">Tu soluciÃ³n inteligente</p>
Â  Â  </div>
Â  Â Â 
Â  Â  <div class="messages-container" id="messagesContainer">
Â  Â  Â  <div class="welcome-message">
Â  Â  Â  Â  <h2>Â¡Bienvenido! ğŸ‘‹</h2>
Â  Â  Â  Â  <p id="welcomeText">Haz tu primera pregunta para comenzar</p>
Â  Â  Â  </div>
Â  Â  Â  <div class="typing-indicator" id="typingIndicator">
Â  Â  Â  Â  <span class="typing-dot"></span>
Â  Â  Â  Â  <span class="typing-dot"></span>
Â  Â  Â  Â  <span class="typing-dot"></span>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div class="input-container">
Â  Â  Â  <div class="input-wrapper">
Â  Â  Â  Â  <inputÂ 
Â  Â  Â  Â  Â  type="text"Â 
Â  Â  Â  Â  Â  id="userInput"Â 
Â  Â  Â  Â  Â  placeholder="Escribe tu mensaje aquÃ­..."
Â  Â  Â  Â  Â  autocomplete="off"
Â  Â  Â  Â  >
Â  Â  Â  Â  <button id="sendButton">Enviar</button>
Â  Â  Â  </div>
Â  Â  </div>
Â  Â Â 
Â  Â  <div class="branding" id="brandingFooter">
Â  Â  Â  Powered by Nocodia
Â  Â  </div>
Â  </div>

Â  <script>
Â  Â  // ========================================================
Â  Â  // ğŸ¯ CONFIGURACIÃ“N POR CLIENTE - SOLO CAMBIA ESTO
Â  Â  // ========================================================
Â  Â  const CLIENTE_CONFIG = {
Â  Â  Â  // 1ï¸âƒ£ INFORMACIÃ“N DEL CLIENTE
Â  Â  Â  nombreCliente: "Demo Empresarial",
Â  Â  Â  subtitulo: "Tu asistente inteligente",
Â  Â  Â  mensajeBienvenida: "Â¿En quÃ© puedo ayudarte hoy?",
Â  Â  Â Â 
Â  Â  Â  // 2ï¸âƒ£ API KEY DE DIFY (Se deja vacÃ­a, la clave estÃ¡ en Cloudflare)
Â  Â  Â  apiKey: "",
Â  Â  Â Â 
Â  Â  Â  // 3ï¸âƒ£ PERSONALIZACIÃ“N DE COLORES (Opcional)
Â  Â  Â  colorPrimario: "#0b75ff",Â  Â  // Color principal del chat
Â  Â  Â  colorSecundario: "#0052cc",Â  // Color secundario
Â  Â  Â Â 
Â  Â  Â  // 4ï¸âƒ£ BRANDING EN EL FOOTER (Opcional)
Â  Â  Â  mostrarBranding: true,Â  Â  Â  Â // true = mostrar, false = ocultar
Â  Â  Â  textoFooter: "Powered by Nocodia"
Â  Â  };
Â  Â  // ========================================================
Â  Â  // âš ï¸ NO MODIFICAR NADA MÃS ABAJO (A menos que sepas lo que haces)
Â  Â  // ========================================================

Â  Â  // Aplicar configuraciÃ³n visual
Â  Â  document.documentElement.style.setProperty('--color-primary', CLIENTE_CONFIG.colorPrimario);
Â  Â  document.documentElement.style.setProperty('--color-secondary', CLIENTE_CONFIG.colorSecundario);
Â  Â  document.getElementById('chatTitle').innerHTML = `ğŸ¤– ${CLIENTE_CONFIG.nombreCliente}`;
Â  Â  document.getElementById('chatSubtitle').textContent = CLIENTE_CONFIG.subtitulo;
Â  Â  document.getElementById('welcomeText').textContent = CLIENTE_CONFIG.mensajeBienvenida;
Â  Â Â 
Â  Â  const brandingFooter = document.getElementById('brandingFooter');
Â  Â  if (CLIENTE_CONFIG.mostrarBranding) {
Â  Â  Â  brandingFooter.textContent = CLIENTE_CONFIG.textoFooter;
Â  Â  } else {
Â  Â  Â  brandingFooter.style.display = 'none';
Â  Â  }

// ConfiguraciÃ³n de API (Modificado para Cloudflare Worker)
const API_CONFIG = {
Â  Â  apiKey: CLIENTE_CONFIG.apiKey,
Â  Â  // âœ¨ URL de tu Worker de Cloudflare, la cual actÃºa como proxy
Â  Â  apiUrl: 'https://dify-chat-proxy.jraul-garcia.workers.dev/',Â 
Â  Â  conversationId: null
};

Â  Â  // Elementos del DOM
Â  Â  const messagesContainer = document.getElementById('messagesContainer');
Â  Â  const userInput = document.getElementById('userInput');
Â  Â  const sendButton = document.getElementById('sendButton');
Â  Â  const typingIndicator = document.getElementById('typingIndicator');

Â  Â  function addMessage(text, isUser = false) {
Â  Â  Â  const welcomeMsg = messagesContainer.querySelector('.welcome-message');
Â  Â  Â  if (welcomeMsg) {
Â  Â  Â  Â  welcomeMsg.remove();
Â  Â  Â  }

Â  Â  Â  const messageDiv = document.createElement('div');
Â  Â  Â  messageDiv.className = `message ${isUser ? 'user' : 'assistant'}`;
Â  Â  Â Â 
Â  Â  Â  const contentDiv = document.createElement('div');
Â  Â  Â  contentDiv.className = 'message-content';
Â  Â  Â  contentDiv.textContent = text;
Â  Â  Â Â 
Â  Â  Â  messageDiv.appendChild(contentDiv);
Â  Â  Â  messagesContainer.insertBefore(messageDiv, typingIndicator);
Â  Â  Â Â 
Â  Â  Â  scrollToBottom();
Â  Â  }

Â  Â  function scrollToBottom() {
Â  Â  Â  messagesContainer.scrollTop = messagesContainer.scrollHeight;
Â  Â  }

Â  Â  function showTyping() {
Â  Â  Â  typingIndicator.classList.add('active');
Â  Â  Â  scrollToBottom();
Â  Â  }

Â  Â  function hideTyping() {
Â  Â  Â  typingIndicator.classList.remove('active');
Â  Â  }

Â  Â  async function sendMessage() {
Â  Â  Â  const message = userInput.value.trim();
Â  Â  Â Â 
Â  Â  Â  if (!message) return;
Â  Â  Â Â 
Â  Â  Â  // âš ï¸ ESTE BLOQUE DE VERIFICACIÃ“N FUE ELIMINADO
Â  Â  Â  // if (API_CONFIG.apiKey === 'app-XXXXXXXXXXXXXXXXX' || API_CONFIG.apiKey.length < 20) { ... }

Â  Â  Â  userInput.value = '';
Â  Â  Â  sendButton.disabled = true;
Â  Â  Â  userInput.disabled = true;

Â  Â  Â  addMessage(message, true);
Â  Â  Â  showTyping();

Â  Â  Â  try {
Â  Â  Â  Â  const response = await fetch(API_CONFIG.apiUrl, {
Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  Â  // âŒ Encabezado Authorization ELIMINADO, el Worker lo aÃ±ade
Â  Â  Â  Â  Â  Â  'Content-Type': 'application/json'
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  body: JSON.stringify({
Â  Â  Â  Â  Â  Â  inputs: {},
Â  Â  Â  Â  Â  Â  query: message,
Â  Â  Â  Â  Â  Â  response_mode: 'blocking',
Â  Â  Â  Â  Â  Â  conversation_id: API_CONFIG.conversationId || '',
Â  Â  Â  Â  Â  Â  user: 'user-' + Date.now()
Â  Â  Â  Â  Â  })
Â  Â  Â  Â  });

Â  Â  Â  Â  hideTyping();

Â  Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  Â  // Si la respuesta no es OK, el error ahora vendrÃ¡ del Worker o de Dify
Â  Â  Â  Â  Â  throw new Error(`Error ${response.status}: ${response.statusText}`);
Â  Â  Â  Â  }

Â  Â  Â  Â  const data = await response.json();
Â  Â  Â  Â Â 
Â  Â  Â  Â  if (data.conversation_id) {
Â  Â  Â  Â  Â  API_CONFIG.conversationId = data.conversation_id;
Â  Â  Â  Â  }

Â  Â  Â  Â  if (data.answer) {
Â  Â  Â  Â  Â  addMessage(data.answer, false);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  addMessage('Lo siento, no pude procesar tu mensaje. Intenta de nuevo.', false);
Â  Â  Â  Â  }

Â  Â  Â  } catch (error) {
Â  Â  Â  Â  hideTyping();
Â  Â  Â  Â  console.error('Error:', error);
Â  Â  Â  Â  addMessage('âŒ Error de conexiÃ³n. Verifica la conexiÃ³n del servidor proxy.', false);
Â  Â  Â  } finally {
Â  Â  Â  Â  sendButton.disabled = false;
Â  Â  Â  Â  userInput.disabled = false;
Â  Â  Â  Â  userInput.focus();
Â  Â  Â  }
Â  Â  }

Â  Â  sendButton.addEventListener('click', sendMessage);
Â  Â Â 
Â  Â  userInput.addEventListener('keypress', (e) => {
Â  Â  Â  if (e.key === 'Enter') {
Â  Â  Â  Â  sendMessage();
Â  Â  Â  }
Â  Â  });

Â  Â  window.addEventListener('load', () => {
Â  Â  Â  userInput.focus();
Â  Â  });
Â  </script>
</body>
</html>
